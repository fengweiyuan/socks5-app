import{d as j,a as I,r as m,L as O,c as P,e as t,w as a,V as _,f as r,W as R,o as k,g as U,i as J,k as n,X as W,q as D,t as C,s as X,E as Y,Y as G}from"./index-99ea873f.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const K={class:"users-container"},Q={class:"card-header"},Z={class:"dialog-footer"},ee=j({__name:"Users",setup(te){const v=I(),g=m(!1),x=m([]),i=m(!1),u=m(null),w=m(),o=m({username:"",email:"",password:"",role:"user",status:"active"}),h={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},y=async()=>{g.value=!0;try{const s=await fetch("/api/v1/users",{headers:{Authorization:`Bearer ${v.token}`}});if(s.ok){const e=await s.json();x.value=e.users}}catch{_.error("获取用户列表失败")}finally{g.value=!1}},E=s=>{u.value=s,o.value={...s},i.value=!0},T=async()=>{w.value&&await w.value.validate(async s=>{if(s)try{const e=u.value?`/api/v1/users/${u.value.id}`:"/api/v1/users",b=u.value?"PUT":"POST";(await fetch(e,{method:b,headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.token}`},body:JSON.stringify(o.value)})).ok&&(_.success(u.value?"用户更新成功":"用户创建成功"),i.value=!1,y())}catch{_.error("操作失败")}})},q=async s=>{try{await Y.confirm("确定要删除这个用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await fetch(`/api/v1/users/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${v.token}`}})).ok&&(_.success("用户删除成功"),y())}catch(e){e!=="cancel"&&_.error("删除失败")}},S=s=>new Date(s).toLocaleString();return O(()=>{y()}),(s,e)=>{const b=r("el-icon"),p=r("el-button"),d=r("el-table-column"),B=r("el-tag"),z=r("el-table"),N=r("el-card"),V=r("el-input"),c=r("el-form-item"),f=r("el-option"),$=r("el-select"),A=r("el-form"),F=r("el-dialog"),L=R("loading");return k(),P("div",K,[t(N,null,{header:a(()=>[U("div",Q,[e[9]||(e[9]=U("span",null,"用户管理",-1)),t(p,{type:"primary",onClick:e[0]||(e[0]=l=>i.value=!0)},{default:a(()=>[t(b,null,{default:a(()=>[t(J(G))]),_:1}),e[8]||(e[8]=n(" 添加用户 ",-1))]),_:1})])]),default:a(()=>[W((k(),D(z,{data:x.value,style:{width:"100%"}},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"username",label:"用户名"}),t(d,{prop:"email",label:"邮箱"}),t(d,{prop:"role",label:"角色"},{default:a(l=>[t(B,{type:l.row.role==="admin"?"danger":"primary"},{default:a(()=>[n(C(l.row.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"status",label:"状态"},{default:a(l=>[t(B,{type:l.row.status==="active"?"success":"info"},{default:a(()=>[n(C(l.row.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"created_at",label:"创建时间"},{default:a(l=>[n(C(S(l.row.created_at)),1)]),_:1}),t(d,{label:"操作",width:"200"},{default:a(l=>[t(p,{size:"small",onClick:M=>E(l.row)},{default:a(()=>[...e[10]||(e[10]=[n("编辑",-1)])]),_:2},1032,["onClick"]),t(p,{size:"small",type:"danger",onClick:M=>q(l.row.id)},{default:a(()=>[...e[11]||(e[11]=[n(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,g.value]])]),_:1}),t(F,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value=l),title:u.value?"编辑用户":"创建用户",width:"500px"},{footer:a(()=>[U("span",Z,[t(p,{onClick:e[6]||(e[6]=l=>i.value=!1)},{default:a(()=>[...e[12]||(e[12]=[n("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:T},{default:a(()=>[...e[13]||(e[13]=[n("确定",-1)])]),_:1})])]),default:a(()=>[t(A,{model:o.value,rules:h,ref_key:"userFormRef",ref:w,"label-width":"80px"},{default:a(()=>[t(c,{label:"用户名",prop:"username"},{default:a(()=>[t(V,{modelValue:o.value.username,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.username=l)},null,8,["modelValue"])]),_:1}),t(c,{label:"邮箱",prop:"email"},{default:a(()=>[t(V,{modelValue:o.value.email,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.email=l)},null,8,["modelValue"])]),_:1}),u.value?X("",!0):(k(),D(c,{key:0,label:"密码",prop:"password"},{default:a(()=>[t(V,{modelValue:o.value.password,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.password=l),type:"password"},null,8,["modelValue"])]),_:1})),t(c,{label:"角色",prop:"role"},{default:a(()=>[t($,{modelValue:o.value.role,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.role=l),placeholder:"选择角色"},{default:a(()=>[t(f,{label:"普通用户",value:"user"}),t(f,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:a(()=>[t($,{modelValue:o.value.status,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.status=l),placeholder:"选择状态"},{default:a(()=>[t(f,{label:"活跃",value:"active"}),t(f,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const oe=H(ee,[["__scopeId","data-v-71d59afd"]]);export{oe as default};
