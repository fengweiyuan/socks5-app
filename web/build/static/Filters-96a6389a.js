import{d as R,a as j,r as c,L as I,c as O,e as t,w as l,V as f,f as n,W as P,o as h,g as w,i as J,k as s,X as W,q as X,t as k,E as Y,Y as G}from"./index-99ea873f.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const K={class:"filters-container"},Q={class:"card-header"},Z={class:"dialog-footer"},ee=R({__name:"Filters",setup(te){const m=j(),v=c(!1),V=c([]),u=c(!1),d=c(null),b=c(),r=c({pattern:"",type:"block",description:"",enabled:!0}),B={pattern:[{required:!0,message:"请输入匹配模式",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},y=async()=>{v.value=!0;try{const a=await fetch("/api/v1/filters",{headers:{Authorization:`Bearer ${m.token}`}});if(a.ok){const e=await a.json();V.value=e.filters}}catch{f.error("获取过滤规则失败")}finally{v.value=!1}},$=a=>{d.value=a,r.value={...a},u.value=!0},D=async()=>{b.value&&await b.value.validate(async a=>{if(a)try{const e=d.value?`/api/v1/filters/${d.value.id}`:"/api/v1/filters",g=d.value?"PUT":"POST";(await fetch(e,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.token}`},body:JSON.stringify(r.value)})).ok&&(f.success(d.value?"过滤规则更新成功":"过滤规则创建成功"),u.value=!1,y())}catch{f.error("操作失败")}})},E=async a=>{try{await Y.confirm("确定要删除这个过滤规则吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await fetch(`/api/v1/filters/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${m.token}`}})).ok&&(f.success("过滤规则删除成功"),y())}catch(e){e!=="cancel"&&f.error("删除失败")}},T=a=>new Date(a).toLocaleString();return I(()=>{y()}),(a,e)=>{const g=n("el-icon"),p=n("el-button"),i=n("el-table-column"),x=n("el-tag"),U=n("el-table"),S=n("el-card"),C=n("el-input"),_=n("el-form-item"),F=n("el-option"),z=n("el-select"),q=n("el-switch"),A=n("el-form"),L=n("el-dialog"),N=P("loading");return h(),O("div",K,[t(S,null,{header:l(()=>[w("div",Q,[e[8]||(e[8]=w("span",null,"URL过滤规则",-1)),t(p,{type:"primary",onClick:e[0]||(e[0]=o=>u.value=!0)},{default:l(()=>[t(g,null,{default:l(()=>[t(J(G))]),_:1}),e[7]||(e[7]=s(" 添加规则 ",-1))]),_:1})])]),default:l(()=>[W((h(),X(U,{data:V.value,style:{width:"100%"}},{default:l(()=>[t(i,{prop:"id",label:"ID",width:"80"}),t(i,{prop:"pattern",label:"匹配模式"}),t(i,{prop:"type",label:"类型"},{default:l(o=>[t(x,{type:o.row.type==="block"?"danger":"success"},{default:l(()=>[s(k(o.row.type==="block"?"阻止":"允许"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"description",label:"描述"}),t(i,{prop:"enabled",label:"状态"},{default:l(o=>[t(x,{type:o.row.enabled?"success":"info"},{default:l(()=>[s(k(o.row.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"created_at",label:"创建时间"},{default:l(o=>[s(k(T(o.row.created_at)),1)]),_:1}),t(i,{label:"操作",width:"200"},{default:l(o=>[t(p,{size:"small",onClick:M=>$(o.row)},{default:l(()=>[...e[9]||(e[9]=[s("编辑",-1)])]),_:2},1032,["onClick"]),t(p,{size:"small",type:"danger",onClick:M=>E(o.row.id)},{default:l(()=>[...e[10]||(e[10]=[s(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,v.value]])]),_:1}),t(L,{modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=o=>u.value=o),title:d.value?"编辑过滤规则":"添加过滤规则",width:"500px"},{footer:l(()=>[w("span",Z,[t(p,{onClick:e[5]||(e[5]=o=>u.value=!1)},{default:l(()=>[...e[11]||(e[11]=[s("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:D},{default:l(()=>[...e[12]||(e[12]=[s("确定",-1)])]),_:1})])]),default:l(()=>[t(A,{model:r.value,rules:B,ref_key:"filterFormRef",ref:b,"label-width":"100px"},{default:l(()=>[t(_,{label:"匹配模式",prop:"pattern"},{default:l(()=>[t(C,{modelValue:r.value.pattern,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.pattern=o),placeholder:"例如: *.google.com"},null,8,["modelValue"])]),_:1}),t(_,{label:"类型",prop:"type"},{default:l(()=>[t(z,{modelValue:r.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.type=o),placeholder:"选择类型"},{default:l(()=>[t(F,{label:"阻止",value:"block"}),t(F,{label:"允许",value:"allow"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"描述",prop:"description"},{default:l(()=>[t(C,{modelValue:r.value.description,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.description=o),type:"textarea"},null,8,["modelValue"])]),_:1}),t(_,{label:"状态",prop:"enabled"},{default:l(()=>[t(q,{modelValue:r.value.enabled,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const ae=H(ee,[["__scopeId","data-v-e5f6db26"]]);export{ae as default};
