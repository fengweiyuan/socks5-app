import{d as A,a as R,r as p,L as $,c as j,e as o,w as s,V as u,f as l,W as T,o as w,g as _,k as d,X as V,q as I,t as b,E as M}from"./index-99ea873f.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";const P={class:"logs-container"},O={class:"card-header"},q={class:"pagination"},W=A({__name:"Logs",setup(X){const v=R(),f=p(!1),m=p([]),c=p(1),g=p(20),h=p(0),i=async()=>{f.value=!0;try{const e=await fetch(`/api/v1/logs?page=${c.value}&size=${g.value}`,{headers:{Authorization:`Bearer ${v.token}`}});if(e.ok){const t=await e.json();m.value=t.logs,h.value=t.total}}catch{u.error("获取日志失败")}finally{f.value=!1}},y=()=>{i()},k=async()=>{try{const e=await fetch("/api/v1/logs/export",{headers:{Authorization:`Bearer ${v.token}`}});if(e.ok){const t=await e.blob(),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="system_logs.csv",a.click(),window.URL.revokeObjectURL(r),u.success("日志导出成功")}}catch{u.error("日志导出失败")}},L=async()=>{try{await M.confirm("确定要清理所有日志吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await fetch("/api/v1/logs",{method:"DELETE",headers:{Authorization:`Bearer ${v.token}`}})).ok&&(u.success("日志清理成功"),i())}catch(e){e!=="cancel"&&u.error("日志清理失败")}},x=e=>{g.value=e,c.value=1,i()},z=e=>{c.value=e,i()},C=e=>new Date(e).toLocaleString();return $(()=>{i()}),(e,t)=>{const r=l("el-button"),a=l("el-table-column"),B=l("el-tag"),E=l("el-table"),S=l("el-pagination"),U=l("el-card"),D=T("loading");return w(),j("div",P,[o(U,null,{header:s(()=>[_("div",O,[t[5]||(t[5]=_("span",null,"系统日志",-1)),_("div",null,[o(r,{onClick:y},{default:s(()=>[...t[2]||(t[2]=[d("刷新",-1)])]),_:1}),o(r,{type:"primary",onClick:k},{default:s(()=>[...t[3]||(t[3]=[d("导出日志",-1)])]),_:1}),o(r,{type:"danger",onClick:L},{default:s(()=>[...t[4]||(t[4]=[d("清理日志",-1)])]),_:1})])])]),default:s(()=>[V((w(),I(E,{data:m.value,style:{width:"100%"}},{default:s(()=>[o(a,{prop:"id",label:"ID",width:"80"}),o(a,{prop:"username",label:"用户名"}),o(a,{prop:"client_ip",label:"客户端IP"}),o(a,{prop:"target_url",label:"目标URL"}),o(a,{prop:"method",label:"方法",width:"80"}),o(a,{prop:"status",label:"状态"},{default:s(n=>[o(B,{type:n.row.status==="success"?"success":"danger"},{default:s(()=>[d(b(n.row.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),o(a,{prop:"user_agent",label:"User Agent","show-overflow-tooltip":""}),o(a,{prop:"timestamp",label:"时间"},{default:s(n=>[d(b(C(n.row.timestamp)),1)]),_:1})]),_:1},8,["data"])),[[D,f.value]]),_("div",q,[o(S,{"current-page":c.value,"onUpdate:currentPage":t[0]||(t[0]=n=>c.value=n),"page-size":g.value,"onUpdate:pageSize":t[1]||(t[1]=n=>g.value=n),"page-sizes":[10,20,50,100],total:h.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:z},null,8,["current-page","page-size","total"])])]),_:1})])}}});const H=N(W,[["__scopeId","data-v-83127365"]]);export{H as default};
