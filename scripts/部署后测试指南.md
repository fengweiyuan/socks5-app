# SOCKS5代理部署后测试指南

## 快速开始

部署完成后，使用以下命令快速检测SOCKS5代理是否正常工作：

### 1. 超快速检测（推荐）
```bash
# 一键检测，5秒内完成
./scripts/quick_proxy_check.sh

# 检测指定代理
./scripts/quick_proxy_check.sh 192.168.1.100 1080
```

### 2. 完整功能测试
```bash
# 使用Bash脚本（推荐）
./scripts/simple_socks5_test.sh

# 使用Python脚本（功能更全面）
python3 scripts/simple_socks5_test.py
```

## 测试脚本说明

| 脚本名称 | 特点 | 适用场景 | 依赖 |
|---------|------|----------|------|
| `quick_proxy_check.sh` | 超快速，3个核心测试 | 部署后快速验证 | 基础系统命令 |
| `simple_socks5_test.sh` | 功能全面，Bash实现 | 日常检测和故障排查 | nc, curl, wget |
| `simple_socks5_test.py` | 功能最全，Python实现 | 详细测试和性能分析 | Python3, requests |

## 常见问题快速解决

### 问题1：连接被拒绝
```bash
❌ 基本连接失败
```
**解决步骤：**
1. 检查服务状态：`ps aux | grep socks5`
2. 检查端口监听：`netstat -tlnp | grep 1082`
3. 重启服务：`./bin/proxy` 或 `./bin/server`

### 问题2：SOCKS5协议不支持
```bash
❌ SOCKS5协议握手失败
```
**解决步骤：**
1. 检查配置文件：`cat configs/config.yaml`
2. 确认代理类型是SOCKS5
3. 检查认证设置

### 问题3：网络访问失败
```bash
❌ 网络访问测试失败
```
**解决步骤：**
1. 测试直连：`curl http://httpbin.org/ip`
2. 检查防火墙：`sudo ufw status`
3. 检查网络配置

## 自动化监控

### 创建监控脚本
```bash
#!/bin/bash
# 创建文件：scripts/monitor_proxy.sh

while true; do
    if ! ./scripts/quick_proxy_check.sh >/dev/null 2>&1; then
        echo "$(date): 代理异常，尝试重启..."
        # 这里添加重启逻辑
        pkill -f socks5
        sleep 2
        ./bin/proxy &
    fi
    sleep 30
done
```

### 设置定时检查
```bash
# 添加到crontab，每5分钟检查一次
*/5 * * * * /path/to/your/project/scripts/quick_proxy_check.sh >/dev/null 2>&1 || echo "代理异常" | mail -s "SOCKS5代理告警" admin@example.com
```

## 性能基准

### 正常性能指标
- **连接建立时间**：< 1秒
- **SOCKS5握手时间**：< 0.5秒
- **HTTP请求响应时间**：< 3秒
- **带宽测试**：> 100 KB/s

### 性能问题排查
```bash
# 测试网络延迟
ping 8.8.8.8

# 测试代理性能
./scripts/simple_socks5_test.sh 127.0.0.1 1082 10 full

# 监控系统资源
top -p $(pgrep -f socks5)
```

## 故障排查清单

### 1. 服务层面
- [ ] 代理服务是否启动？
- [ ] 端口是否正确监听？
- [ ] 配置文件是否正确？
- [ ] 日志是否有错误信息？

### 2. 网络层面
- [ ] 服务器网络是否正常？
- [ ] 防火墙是否阻止连接？
- [ ] DNS解析是否正常？
- [ ] 目标服务器是否可达？

### 3. 应用层面
- [ ] SOCKS5协议是否支持？
- [ ] 认证配置是否正确？
- [ ] 用户权限是否足够？
- [ ] 流量限制是否合理？

## 测试命令速查

### 基础检测
```bash
# 检查服务状态
ps aux | grep socks5
netstat -tlnp | grep 1082

# 快速功能测试
./scripts/quick_proxy_check.sh

# 完整功能测试
./scripts/simple_socks5_test.sh
```

### 网络测试
```bash
# 测试直连网络
curl http://httpbin.org/ip
ping 8.8.8.8

# 测试代理网络
curl --socks5 127.0.0.1:1082 http://httpbin.org/ip
```

### 性能测试
```bash
# 带宽测试
curl --socks5 127.0.0.1:1082 -o /dev/null -s -w "速度: %{speed_download} bytes/sec\n" http://httpbin.org/bytes/1048576

# 延迟测试
time curl --socks5 127.0.0.1:1082 -s http://httpbin.org/ip
```

## 日志分析

### 查看代理日志
```bash
# 应用日志
tail -f logs/app.log

# 代理日志
tail -f logs/proxy.log

# 服务器日志
tail -f logs/server.log
```

### 常见错误信息
- `Connection refused` → 服务未启动
- `Authentication failed` → 认证失败
- `Network unreachable` → 网络不可达
- `Connection timeout` → 连接超时

## 总结

使用这些测试脚本可以快速定位SOCKS5代理的问题：

1. **部署后立即使用** `quick_proxy_check.sh` 验证基本功能
2. **日常监控使用** `simple_socks5_test.sh` 进行全面检测
3. **故障排查使用** `simple_socks5_test.py` 进行详细分析

记住：**快速检测 → 问题定位 → 详细分析 → 问题解决**
