# SOCKS5 代理流量测试脚本使用说明

## 🎯 功能说明

这些 Python 脚本用于向 SOCKS5 代理发送持续流量，以便测试和观察 Web 管理界面中的流量统计功能。

## 📁 脚本文件

### 1. `continuous_traffic.py` - 推荐使用 ⭐
**最简单的持续流量生成脚本**

```bash
python3 scripts/continuous_traffic.py
```

**特点：**
- 交互式输入用户名、密码和持续时间
- 持续生成 HTTP 流量
- 实时显示请求状态
- 自动统计流量数据

### 2. `traffic_generator.py` - 完整功能
**功能最全面的流量生成器**

```bash
# 查看所有选项
python3 scripts/traffic_generator.py --help

# 持续生成混合流量
python3 scripts/traffic_generator.py --mode continuous

# 生成 HTTP 流量，持续 60 秒
python3 scripts/traffic_generator.py --mode http --duration 60
```

### 3. `http_only_traffic_test.py` - HTTP 专用
**专门测试 HTTP 流量的脚本**

```bash
python3 scripts/http_only_traffic_test.py
```

## 🚀 快速开始

### 步骤 1: 安装依赖
```bash
python3 scripts/install_traffic_deps.py
```

### 步骤 2: 运行流量生成器
```bash
python3 scripts/continuous_traffic.py
```

### 步骤 3: 输入参数
- 用户名: `testuser` (默认)
- 密码: `testpass` (默认)
- 持续时间: `300` 秒 (默认)

### 步骤 4: 观察流量统计
打开浏览器访问: http://localhost:8012
- 登录系统 (用户名: admin, 密码: admin)
- 进入「流量管理」页面
- 查看实时流量监控图表
- 查看流量日志

## 📊 测试结果验证

### 数据库查询
```sql
-- 查看总流量统计
SELECT 
    COUNT(*) as total_requests,
    SUM(bytes_sent) as total_sent_bytes,
    SUM(bytes_recv) as total_recv_bytes
FROM traffic_logs 
WHERE user_id = 4;

-- 查看最近的流量记录
SELECT * FROM traffic_logs 
ORDER BY timestamp DESC 
LIMIT 10;

-- 查看活跃会话
SELECT * FROM proxy_sessions 
WHERE status = 'active';
```

### Web 界面验证
1. **流量统计概览**: 查看总发送/接收流量
2. **实时监控图表**: 观察流量趋势
3. **流量日志**: 查看详细的请求记录
4. **用户统计**: 查看在线用户和活跃连接

## ⚠️ 注意事项

### 关于 400 状态码
- 虽然 HTTP 请求返回 400 状态码，但这是正常的
- 代理服务器正在正确记录所有流量数据
- 流量统计功能完全正常工作

### 性能建议
- 建议持续时间: 60-300 秒
- 请求间隔: 1-3 秒 (自动随机)
- 避免过高的请求频率，以免影响系统性能

### 网络要求
- 确保代理服务正常运行 (端口 1082)
- 确保网络连接正常
- 某些测试网站可能有访问限制

## 🔧 故障排除

### 认证失败
```
SOCKS5 authentication failed
```
**解决方案：**
1. 确认用户名和密码正确
2. 检查用户状态是否为 `active`
3. 重新创建测试用户: `python3 scripts/create_test_user.py`

### 连接超时
```
Max retries exceeded
```
**解决方案：**
1. 检查代理服务是否运行: `ps aux | grep proxy`
2. 检查代理端口: `netstat -an | grep 1082`
3. 重启代理服务: `make restart`

### 依赖包问题
```
ModuleNotFoundError
```
**解决方案：**
```bash
pip install requests PySocks bcrypt pymysql
```

## 📈 监控建议

### 实时监控
1. 运行流量生成脚本
2. 同时打开 Web 管理界面
3. 观察「流量管理」页面的实时更新
4. 查看流量图表的变化

### 数据验证
1. 记录脚本显示的统计信息
2. 对比 Web 界面的统计数据
3. 验证数据库中的记录
4. 确认数据一致性

## 🎉 成功标志

当看到以下情况时，说明流量统计功能正常工作：

1. ✅ 脚本显示请求正在发送
2. ✅ 代理日志显示流量记录
3. ✅ 数据库中有新的流量记录
4. ✅ Web 界面显示实时统计数据
5. ✅ 流量图表实时更新

现在您可以放心使用这些脚本来测试和验证流量统计功能了！
